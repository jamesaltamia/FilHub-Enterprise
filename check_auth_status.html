<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Status Checker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>FilHub Enterprise - Auth Status Checker</h1>
    <div id="status"></div>
    
    <script>
        function checkAuthStatus() {
            const statusDiv = document.getElementById('status');
            
            // Get auth data from localStorage
            const token = localStorage.getItem('token') || localStorage.getItem('auth_token');
            const role = localStorage.getItem('role');
            const user = localStorage.getItem('user');
            const permissions = localStorage.getItem('permissions');
            
            let html = '<h2>Current Authentication Status</h2>';
            
            if (!token) {
                html += '<div class="status error">❌ No authentication token found</div>';
                html += '<p>You need to log in first.</p>';
            } else {
                html += '<div class="status success">✅ Authentication token found</div>';
                html += `<div class="status info"><strong>Token:</strong> ${token.substring(0, 20)}...</div>`;
            }
            
            if (!role) {
                html += '<div class="status error">❌ No role found</div>';
            } else {
                html += `<div class="status ${role === 'admin' ? 'success' : 'info'}">
                    <strong>Role:</strong> ${role} ${role === 'admin' ? '✅ (Can add products)' : '⚠️ (Cannot add products)'}
                </div>`;
            }
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    html += '<div class="status info"><strong>User Data:</strong></div>';
                    html += `<pre>${JSON.stringify(userData, null, 2)}</pre>`;
                } catch (e) {
                    html += '<div class="status error">❌ Invalid user data format</div>';
                }
            } else {
                html += '<div class="status error">❌ No user data found</div>';
            }
            
            if (permissions) {
                try {
                    const permsData = JSON.parse(permissions);
                    html += '<div class="status info"><strong>Permissions:</strong></div>';
                    html += `<pre>${JSON.stringify(permsData, null, 2)}</pre>`;
                } catch (e) {
                    html += '<div class="status error">❌ Invalid permissions data format</div>';
                }
            } else {
                html += '<div class="status error">❌ No permissions data found</div>';
            }
            
            // Add recommendations
            html += '<h3>Recommendations:</h3>';
            if (!token) {
                html += '<p>1. Go to the login page and authenticate</p>';
            } else if (role !== 'admin') {
                html += '<p>1. Your current role is "' + role + '" but you need "admin" role to add products</p>';
                html += '<p>2. Contact your system administrator to upgrade your role to admin</p>';
                html += '<p>3. Or we can modify the system to allow your current role to add products</p>';
            } else {
                html += '<p>1. ✅ You should be able to add products with admin role</p>';
                html += '<p>2. If you still can\'t add products, there might be a backend API issue</p>';
            }
            
            statusDiv.innerHTML = html;
        }
        
        // Check status on page load
        checkAuthStatus();
        
        // Add refresh button
        document.addEventListener('DOMContentLoaded', function() {
            const refreshBtn = document.createElement('button');
            refreshBtn.textContent = 'Refresh Status';
            refreshBtn.onclick = checkAuthStatus;
            refreshBtn.style.marginTop = '20px';
            refreshBtn.style.padding = '10px 20px';
            refreshBtn.style.backgroundColor = '#007bff';
            refreshBtn.style.color = 'white';
            refreshBtn.style.border = 'none';
            refreshBtn.style.borderRadius = '5px';
            refreshBtn.style.cursor = 'pointer';
            document.body.appendChild(refreshBtn);
        });
    </script>
</body>
</html>
